# SU Daemon Protocol
## Basic wrapper

To initialise a session, a new FIFO pipe is created in /system/etc/nomagic/sureqs/rAnd0MbYt35 (sureqs is a tmpfs). The su daemon is using inotify to wait for this. Since the directory is chmod uga-rw, it cannot be listed by non-root processes, so nothing else could spy on our connection. Once the incoming request is detected, the su daemon connects to the stream and reads a single line. It receives some random bytes on this stream. Since fifo pipes are unidirectional in posix, we have to setup one pipe for each direction. The random bytes received by the su daemon are used to open another fifo in /system/etc/nomagic/sus, which is used for the sud to reply to messages. As soon as it has opened this pipe, sud writes its version number. When the su client receives this, it checks it matches and, if it doesnt, aborts. Then it reads the tty, which is either an integer that exists in /dev/pts/N, or blank. If its blank, that means to use some more pipes to communicate. These pipes, however, are initialised by the su daemon and sent to the client for usage. TBC.
